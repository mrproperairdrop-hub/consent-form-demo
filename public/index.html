<!DOCTYPE html>
<html lang='ru'>
    <head>
        <meta charset="UTF-8"/>
        <meta name ='viewport' content = 'width=device-width, initial scale=1'/>
        <title> Consent form </title>
            <style>
                * {
                    box-sizing: border-box;
                }
                body {
                    font-family: system-ui, Arial; 
                    max-width: 720px; 
                    margin: 40px auto; 
                    padding: 0 16px;
                }
                .card { 
                    border: 1px solid #ddd; 
                    border-radius: 12px; 
                    padding: 16px; 
                }
                label { 
                    display:block; 
                    margin-top: 12px; 
                }
                input[type="text"], input[type="email"] { 
                    width: 100%;
                    padding: 14px 16px;     
                    margin-top: 8px;
                    font-size: 16px;        
                    border-radius: 10px;
                    border: 1px solid #ccc;
                }
                input[type="checkbox"]{
                    transform: scale(1.6);
                    transform-origin: left center;
                    margin-right: 10px;
                    }
                button { 
                    margin-top: 14px; 
                    padding: 10px 14px; 
                    cursor: pointer; 
                }
                .row { 
                    display:flex; 
                    gap:10px; 
                    align-items:flex-start; 
                    margin-top: 12px; 
                }
                .row input[type="checkbox"] { 
                    width:auto; 
                    margin-top: 2px; 
                }
                #status { 
                    margin-top: 10px; 
                    font-size: 14px; 
                    color: #444; 
                }
                .submit-btn{
                    display: block;
                    width: 100%;
                    padding: 16px 18px;
                    font-size: 18px;
                    border-radius: 12px;
                    border: none;
                    background: #0a84ff;
                    color: white;
                    font-weight: 700;
                    cursor: pointer;
                    margin-top: 18px;
                }
                .submit-btn:active{
                    transform: scale(0.98);
                }
            </style>
    </head>
    <body>
        <h1>Введите свои данные</h1>

        <div class="card">
            <p>
                Вы зашли на сайт nenayobivaem.naebem!
            </p>

            <form id="demoForm">
            <label>
                Имя
                <input name="name" type="text" required minlength="2" maxlength="50" placeholder="Alex" />
            </label>

            <label>
                Email
                <input name="email" type="email" required placeholder="test@example.com" />
            </label>

            <div class="row">
                <input id="consent" name="consent" type="checkbox" required />
                <label for="consent">
                Подтверждаю, что ознакомлен с пользовательским соглашением
                </label>
            </div>

            <button type="submit" class="submit-btn">Отправить</button>
            <div id="status"></div>
            </form>
        </div>

            <script>
                const form = document.getElementById('demoForm');
                const statusEl = document.getElementById('status');

                function getDeviceType() {
                    const ua = navigator.userAgent || '';
                    return /mobile|android|iphone|ipad|ipod/i.test(ua) ? 'mobile' : 'desktop';
                }

                function collectClientInfo() {
                    return {
                    clientTime: new Date().toISOString(),
                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone || null,
                    language: navigator.language || null,
                    languages: Array.isArray(navigator.languages) ? navigator.languages : null,
                    platform: navigator.platform || null,
                    userAgent: navigator.userAgent || null,
                    deviceType: getDeviceType(),
                    referrer: document.referrer || null,
                    screen: {
                        width: screen.width,
                        height: screen.height,
                    },
                    viewport: {
                        width: window.innerWidth,
                        height: window.innerHeight,
                    },
                    };
                }

                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    statusEl.textContent = 'Отправляю...';

                    const fd = new FormData(form);
                    const data = Object.fromEntries(fd.entries());

                    data.consent = data.consent === 'on';
                    data.client = collectClientInfo();

                    try {
                    const res = await fetch('/api/submit', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    const json = await res.json();
                    if (!res.ok) throw new Error(json.error || 'Request failed');

                    statusEl.textContent = 'Готово ✅ (сохранено)';
                    form.reset();
                    } catch (err) {
                    statusEl.textContent = 'Ошибка ❌: ' + err.message;
                    }
                });
        </script>
    </body>

</html>